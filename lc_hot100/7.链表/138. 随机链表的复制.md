```cpp
/*
// Definition for a Node.
class Node {
public:
    int val;
    Node* next;
    Node* random;

    Node(int _val) {
        val = _val;
        next = NULL;
        random = NULL;
    }
};
*/

class Solution {
public:
    Node* copyRandomList(Node* head) {
        unordered_map<Node *,Node *> mp;
        auto cur = head;
        while(cur)
        {
            mp[cur] = new Node(cur->val);
            cur = cur->next;
        }
        cur = head;
        while(cur)
        {
            mp[cur]->next = mp[cur->next];
            mp[cur]->random = mp[cur->random];
            cur = cur->next;
        }

        return mp[head];
    }
};
```

python要比C++多一些判断

```python
"""
# Definition for a Node.
class Node:
    def __init__(self, x: int, next: 'Node' = None, random: 'Node' = None):
        self.val = int(x)
        self.next = next
        self.random = random
"""

class Solution:
    def copyRandomList(self, head: 'Optional[Node]') -> 'Optional[Node]':
        if not head :
            return None

        mp = {}
        a = head
        while a:
            mp[a] = Node(x=a.val)
            a = a.next

        a = head
        while a:
            if a.next:
                mp[a].next = mp[a.next]
            else :
                mp[a].next = None
            if a.random:
                mp[a].random = mp[a.random]
            else :
                mp[a].random = None
            a = a.next

        return mp[head]
```
